# Математические модели для Bluetooth навигации в помещениях

## 1. Модель распространения сигнала

### 1.1 Модель окружения (Free Space Path Loss)
Для расчета расстояния по RSSI используется модифицированная модель:

$$
RSSI = A - 10n \log_{10}(d)
$$

Где:
- $RSSI$ - уровень принимаемого сигнала
- $A$ - уровень сигнала на расстоянии 1 метра (TX Power)
- $n$ - коэффициент затухания (обычно 2-4 в помещениях)
- $d$ - расстояние до маячка в метрах

Отсюда можно выразить расстояние:

$$
d = 10^{\frac{RSSI - A}{-10n}}
$$

### 1.2 Уточненная модель для внутренних помещений
Для более точного определения расстояния в помещениях с препятствиями:

$$
d = 10^{\frac{RSSI - A + PL_{add}}{-10n}}
$$

Где $PL_{add}$ - дополнительные потери на препятствиях.

## 2. Модель определения местоположения

### 2.1 Трилатерация
Трилатерация - метод определения координат объекта по расстояниям до трех или более известных точек.

Для трех маячков с координатами $(x_1, y_1)$, $(x_2, y_2)$, $(x_3, y_3)$ и расстояниями до них $d_1$, $d_2$, $d_3$, решаем систему уравнений:

$$
\begin{cases}
(x - x_1)^2 + (y - y_1)^2 = d_1^2 \\
(x - x_2)^2 + (y - y_2)^2 = d_2^2 \\
(x - x_3)^2 + (y - y_3)^2 = d_3^2
\end{cases}
$$

Преобразуем в систему линейных уравнений:

$$
\begin{cases}
2(x_2 - x_1)x + 2(y_2 - y_1)y = (x_2^2 - x_1^2) + (y_2^2 - y_1^2) - (d_2^2 - d_1^2) \\
2(x_3 - x_2)x + 2(y_3 - y_2)y = (x_3^2 - x_2^2) + (y_3^2 - y_2^2) - (d_3^2 - d_2^2)
\end{cases}
$$

Решение системы:
$$
\begin{align}
x &= \frac{(y_3 - y_1)(d_2^2 - d_1^2 - x_2^2 + x_1^2 - y_2^2 + y_1^2) - (y_2 - y_1)(d_3^2 - d_1^2 - x_3^2 + x_1^2 - y_3^2 + y_1^2)}{2[(x_2 - x_1)(y_3 - y_1) - (x_3 - x_1)(y_2 - y_1)]} \\
y &= \frac{(x_3 - x_1)(d_2^2 - d_1^2 - x_2^2 + x_1^2 - y_2^2 + y_1^2) - (x_2 - x_1)(d_3^2 - d_1^2 - x_3^2 + x_1^2 - y_3^2 + y_1^2)}{2[(y_2 - y_1)(x_3 - x_1) - (y_3 - y_1)(x_2 - x_1)]}
\end{align}
$$

### 2.2 Многомерная трилатерация (метод наименьших квадратов)
Когда доступно более 3 маячков, используется метод наименьших квадратов для улучшения точности:

$$
\min_{x,y} \sum_{i=1}^{n} w_i \cdot (r_i - \sqrt{(x - x_i)^2 + (y - y_i)^2})^2
$$

Где:
- $w_i$ - вес i-го маячка (обратно пропорционален ошибке измерения)
- $r_i$ - измеренное расстояние до i-го маячка
- $(x_i, y_i)$ - координаты i-го маячка

## 3. Фильтрация сигналов

### 3.1 Скользящее среднее
Для сглаживания RSSI-сигнала:

$$
\overline{RSSI}_k = \frac{1}{N} \sum_{i=k-N+1}^{k} RSSI_i
$$

### 3.2 Фильтр Калмана
Для фильтрации координат пользователя:

Система уравнений:
$$
\begin{align}
\hat{x}_k^- &= F_k \hat{x}_{k-1} + B_k u_k \\
P_k^- &= F_k P_{k-1} F_k^T + Q_k
\end{align}
$$

Коэффициент Калмана:
$$
K_k = \frac{P_k^-}{P_k^- + R_k}
$$

Обновление оценки:
$$
\begin{align}
\hat{x}_k &= \hat{x}_k^- + K_k(z_k - H_k \hat{x}_k^-) \\
P_k &= (I - K_k H_k) P_k^-
\end{align}
$$

Где:
- $\hat{x}_k$ - оценка состояния в момент k
- $P_k$ - ковариационная матрица ошибки
- $Q_k$ - ковариация процесса шума
- $R_k$ - ковариация измерительного шума

## 4. Модель построения маршрута

### 4.1 Алгоритм A*
Функция оценки стоимости:
$$
f(n) = g(n) + h(n)
$$

Где:
- $f(n)$ - оценка полной стоимости пути через узел n
- $g(n)$ - стоимость пути от начального узла до узла n
- $h(n)$ - эвристическая оценка стоимости от узла n до цели

### 4.2 Эвристическая функция (Евклидово расстояние)
$$
h(n) = \sqrt{(x_n - x_{goal})^2 + (y_n - y_{goal})^2}
$$

## 5. Модель точности определения местоположения

### 5.1 Оценка точности
Точность определения местоположения зависит от:
- Количества доступных маячков
- Геометрической конфигурации маячков
- Качества измерений RSSI

Оценка точности:
$$
\sigma_{pos} = \sqrt{\frac{\sum_{i=1}^{n} \sigma_i^2}{n}}
$$

Где $\sigma_i$ - ошибка определения расстояния до i-го маячка.

### 5.2 Геометрический фактор (GDOP - Geometric Dilution of Precision)
$$
GDOP = \sqrt{\text{trace}((H^T R^{-1} H)^{-1})}
$$

Где:
- $H$ - матрица геометрии (jacobian матрица)
- $R$ - ковариационная матрица измерений

## 6. Модель энергопотребления

### 6.1 Энергопотребление при сканировании BLE
$$
P_{scan} = I_{scan} \times V_{supply}
$$

Среднее энергопотребление за время сканирования:
$$
E_{scan} = P_{scan} \times T_{scan} \times \frac{T_{interval}}{T_{window}}
$$

Где:
- $I_{scan}$ - ток потребления в режиме сканирования
- $T_{scan}$ - время сканирования
- $T_{interval}$ - интервал между сканированиями
- $T_{window}$ - продолжительность окна сканирования

## 7. Модель вероятности обнаружения маячка

### 7.1 Вероятность обнаружения на расстоянии
$$
P_{detect}(d) = \frac{1}{1 + e^{-k(d_0 - d)}}
$$

Где:
- $d$ - расстояние до маячка
- $d_0$ - номинальное расстояние обнаружения
- $k$ - коэффициент крутизны функции

Эти математические модели лежат в основе алгоритмов, реализованных в системе Bluetooth навигации в помещениях, и обеспечивают точное определение местоположения и эффективную навигацию.