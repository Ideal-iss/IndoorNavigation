# Структура мобильного приложения для Bluetooth навигации в помещениях

## 1. Общая архитектура

Мобильное приложение реализовано с использованием React Native и состоит из следующих основных компонентов:

```
mobile/
├── src/
│   ├── components/           # Повторно используемые компоненты
│   ├── screens/             # Экраны приложения
│   ├── services/            # Сервисы для работы с API и BLE
│   ├── utils/               # Вспомогательные утилиты
│   ├── hooks/               # Пользовательские хуки
│   ├── context/             # Контексты приложения
│   └── navigation/          # Навигация между экранами
├── assets/                  # Ресурсы (изображения, шрифты)
├── App.js                   # Главный компонент приложения
└── package.json             # Зависимости и настройки
```

## 2. Компоненты пользовательского интерфейса

### 2.1 Компонент карты помещения
- Отображает карту текущего помещения
- Показывает местоположение пользователя
- Отображает маршрут до цели
- Показывает точки интереса

### 2.2 Компонент сканирования BLE
- Сканирует доступные BLE-маячки
- Отображает список обнаруженных устройств
- Показывает уровень сигнала (RSSI)

### 2.3 Компонент навигации
- Отображает текущий маршрут
- Показывает инструкции по навигации
- Индикация направления движения

## 3. Экраны приложения

### 3.1 Экран выбора помещения (RoomSelectionScreen)
- Показывает список доступных помещений
- Позволяет выбрать помещение для навигации
- Отображает информацию о помещениях

### 3.2 Экран карты (MapScreen)
- Отображает карту выбранного помещения
- Показывает текущее местоположение пользователя
- Позволяет выбрать точку назначения
- Отображает маршрут и навигационные инструкции

### 3.3 Экран точек интереса (POIScreen)
- Показывает список точек интереса в помещении
- Позволяет выбрать точку для построения маршрута
- Отображает информацию о точках

### 3.4 Экран настроек (SettingsScreen)
- Настройки точности сканирования
- Настройки обновления местоположения
- Настройки уведомлений

## 4. Сервисы

### 4.1 BLEService
- Сканирование BLE-устройств
- Подключение к маячкам
- Получение данных RSSI
- Фильтрация и обработка данных

```javascript
// Пример структуры BLEService
class BLEService {
  startScanning();
  stopScanning();
  getBeaconData();
  calculateDistance(rssi, txPower);
}
```

### 4.2 LocationService
- Обработка данных от BLE-маячков
- Вычисление координат пользователя
- Фильтрация координат
- Обновление местоположения

```javascript
// Пример структуры LocationService
class LocationService {
  processBeaconData(beaconData);
  calculateUserLocation(beacons);
  filterLocation(location);
  getLocationUpdates();
}
```

### 4.3 NavigationService
- Взаимодействие с серверным API
- Построение маршрутов
- Обновление маршрута в реальном времени

```javascript
// Пример структуры NavigationService
class NavigationService {
  getRoute(start, end, roomId);
  updateRoute(currentLocation, destination);
  getPOI(roomId, type);
}
```

### 4.4 APIService
- Взаимодействие с серверным API
- Отправка данных о местоположении
- Получение информации о помещениях и маячках

## 5. Основные функции приложения

### 5.1 Определение местоположения
1. Сканирование BLE-маячков
2. Получение данных RSSI
3. Расчет расстояний до маячков
4. Трилатерация для определения координат
5. Фильтрация координат

### 5.2 Построение маршрута
1. Выбор точки назначения
2. Запрос маршрута с сервера
3. Отображение маршрута на карте
4. Обновление маршрута при движении

### 5.3 Отображение информации
1. Отображение карты помещения
2. Показ текущего местоположения
3. Отображение точек интереса
4. Показ навигационных инструкций

## 6. Работа с BLE в React Native

### 6.1 Установка библиотеки
```bash
npm install react-native-ble-plx
```

### 6.2 Запрос разрешений
- Bluetooth scanning permissions
- Location permissions (на Android)

### 6.3 Основные методы
```javascript
// Сканирование устройств
manager.startDeviceScan(null, null, (error, device) => {
  if (error) {
    console.log(error.message);
    return;
  }
  
  // Обработка обнаруженного устройства
  processBeacon(device);
});

// Получение данных о силе сигнала
device.readRSSI();
```

## 7. Безопасность и энергопотребление

### 7.1 Энергопотребление
- Адаптивная частота сканирования
- Оптимизация работы в фоновом режиме
- Использование энергоэффективных алгоритмов

### 7.2 Безопасность
- Шифрование передаваемых данных
- Защита персональных данных
- Анонимность местоположения

## 8. Тестирование мобильного приложения

### 8.1 Модульное тестирование
- Тестирование сервисов
- Тестирование утилит
- Тестирование хуков

### 8.2 Интеграционное тестирование
- Тестирование взаимодействия с BLE
- Тестирование API-запросов
- Тестирование навигации

### 8.3 Тестирование пользовательского интерфейса
- Тестирование экранов
- Тестирование взаимодействия с картой
- Тестирование производительности